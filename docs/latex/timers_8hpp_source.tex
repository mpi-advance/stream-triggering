\doxysection{timers.\+hpp}
\hypertarget{timers_8hpp_source}{}\label{timers_8hpp_source}\index{tests/benchmark/timers.hpp@{tests/benchmark/timers.hpp}}
\mbox{\hyperlink{timers_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ BENCHMARK\_TIMING}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ BENCHMARK\_TIMING}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{common_8hpp}{common.hpp}}"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceTiming}{Timing}}}
\DoxyCodeLine{00009\ \{}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#if\ defined\ NEED\_HIP}}
\DoxyCodeLine{00012\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classThreadQueue}{Timings}}\ =\ \mbox{\hyperlink{classThreadQueue}{hipEvent\_t}};}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00014\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classThreadQueue}{Timings}}\ =\ \mbox{\hyperlink{classThreadQueue}{double}};}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \mbox{\hyperlink{classThreadQueue}{Timings}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}};}
\DoxyCodeLine{00018\ std::vector<Timings>\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}};}
\DoxyCodeLine{00019\ std::vector<Timings>::iterator\ \mbox{\hyperlink{namespaceTiming_ae9f4386aa6a6fe97eeccc86613ef22dc}{curr\_iter}};}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a378f84624b3da6bf1a0b396dae816249}{total\_iters}};}
\DoxyCodeLine{00022\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespaceTiming_a8d587e28ab08a7d46f1d3e92fc0dbd84}{num\_timings}}\ \ \ \ \ =\ 10;}
\DoxyCodeLine{00023\ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a2f5b696cb0d9ae9b08bd0e5529c8d9a0}{percent\_tracker}}\ =\ 10;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ init\_timers(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classThreadQueue}{iterations}})}
\DoxyCodeLine{00026\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a378f84624b3da6bf1a0b396dae816249}{total\_iters}}\ =\ \mbox{\hyperlink{classThreadQueue}{iterations}};}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#if\ defined\ NEED\_HIP}}
\DoxyCodeLine{00029\ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{force\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventCreateWithFlags}}(\&\mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}},\ \mbox{\hyperlink{classThreadQueue}{hipEventDisableSystemFence}}));}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}}\ =\ std::vector<Timings>(\mbox{\hyperlink{namespaceTiming_a8d587e28ab08a7d46f1d3e92fc0dbd84}{num\_timings}},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{classThreadQueue}{timer}}\ :\ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}})}
\DoxyCodeLine{00032\ \ \ \ \ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{force\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventCreateWithFlags}}(\&\mbox{\hyperlink{classThreadQueue}{timer}},\ \mbox{\hyperlink{classThreadQueue}{hipEventDisableSystemFence}}));}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}}\ =\ std::vector<Timings>(\mbox{\hyperlink{namespaceTiming_a8d587e28ab08a7d46f1d3e92fc0dbd84}{num\_timings}},\ 0.0);}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{namespaceTiming_ae9f4386aa6a6fe97eeccc86613ef22dc}{curr\_iter}}\ =\ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}}.begin();}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ set\_base\_timer()}
\DoxyCodeLine{00042\ \{}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#if\ defined\ NEED\_HIP}}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{check\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventRecord}}(\mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}}));}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}}\ =\ \mbox{\hyperlink{classThreadQueue}{MPI\_Wtime}}();}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ print\_timers(\textcolor{keywordtype}{int}\ rank)}
\DoxyCodeLine{00051\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ index\ =\ 0;\ index\ <\ \mbox{\hyperlink{namespaceTiming_a8d587e28ab08a7d46f1d3e92fc0dbd84}{num\_timings}};\ ++index)}
\DoxyCodeLine{00053\ \ \ \ \ \{}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#if\ defined\ NEED\_HIP}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classThreadQueue}{time}}\ =\ 0.0;}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{check\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventElapsedTime}}(\&\mbox{\hyperlink{classThreadQueue}{time}},\ \mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}},\ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}}[index]));}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classThreadQueue}{time}}\ =\ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}}[index]\ -\/\ \mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}};}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}[Rank\ "{}}\ <<\ \mbox{\hyperlink{namespacePrint_af012c9be6f11e5211c9dae8b574fd25b}{rank}}\ <<\ \textcolor{stringliteral}{"{},\ Timer\ "{}}<<\ index\ <<\ \textcolor{stringliteral}{"{}]:\ "{}}\ <<\ \mbox{\hyperlink{classThreadQueue}{time}}\ <<\ std::endl;}
\DoxyCodeLine{00061\ \ \ \ \ \}}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ free\_timers()}
\DoxyCodeLine{00065\ \{}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#if\ defined\ NEED\_HIP}}
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{check\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventDestroy}}(\mbox{\hyperlink{namespaceTiming_a9e27f3aa8d14c37a5c0d5c3dadd09525}{base\_timer}}));}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{classThreadQueue}{timer}}\ :\ \mbox{\hyperlink{namespaceTiming_a771db286eee23d06d02d58bfb363d4b2}{global\_timers}})}
\DoxyCodeLine{00069\ \ \ \ \ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classThreadQueue}{timer}}\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{check\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventDestroy}}(\mbox{\hyperlink{classThreadQueue}{timer}}));}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ add\_timer(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classThreadQueue}{iter}})}
\DoxyCodeLine{00079\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{iter}}++;}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classThreadQueue}{iter}}\ *\ 100\ >=\ \mbox{\hyperlink{namespaceTiming_a2f5b696cb0d9ae9b08bd0e5529c8d9a0}{percent\_tracker}}\ *\ \mbox{\hyperlink{namespaceTiming_a378f84624b3da6bf1a0b396dae816249}{total\_iters}})}
\DoxyCodeLine{00082\ \ \ \ \ \{}
\DoxyCodeLine{00083\ \textcolor{preprocessor}{\#if\ defined\ NEED\_HIP}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThreadQueue}{check\_gpu}}(\mbox{\hyperlink{classThreadQueue}{hipEventRecord}}(*\mbox{\hyperlink{namespaceTiming_ae9f4386aa6a6fe97eeccc86613ef22dc}{curr\_iter}}));}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{namespaceTiming_ae9f4386aa6a6fe97eeccc86613ef22dc}{curr\_iter}}\ =\ \mbox{\hyperlink{classThreadQueue}{MPI\_Wtime}}();}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceTiming_a2f5b696cb0d9ae9b08bd0e5529c8d9a0}{percent\_tracker}}\ +=\ 10;}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceTiming_ae9f4386aa6a6fe97eeccc86613ef22dc}{curr\_iter}}++;}
\DoxyCodeLine{00090\ \ \ \ \ \}}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \}\ \ \textcolor{comment}{//\ namespace\ Timing}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
